<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Aikido: State Space Concept</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Aikido
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d0/d16/md_include_aikido_statespace_README.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">State Space Concept </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This directory contains <code>StateSpace</code> intended to represent the configuration space of an arbitrary robot and provides utilities for mapping between a <code>StateSpace</code> and the <code>DegreeOfFreedom</code>s of a DART <code>MetaSkeleton</code>. The following <code>StateSpace</code> types are included:</p>
<ul>
<li><code>Rn</code> an <code>n</code>-dimensional real vector space</li>
<li><code>SO2</code> the space of planar rotations</li>
<li><code>SO3</code> the space of spatial rotations</li>
<li><code>CartesianProduct</code> of other <code>StateSpace</code>s</li>
</ul>
<p>Each of these <code>StateSpace</code> classes is paired with a <code>StateSpace::State</code> class that represents an element of that state. The <code>StateSpace</code> stores <em>all</em> information that is common between <code>State</code>s to keep that class as lightweight as possible. This is critical because motion planning algorithms tend to create large numbers of <code>State</code>s.</p>
<h2><a class="anchor" id="autotoc_md1"></a>
Creating and Destroying &lt;tt&gt;State&lt;/tt&gt;s</h2>
<p>For a *fixed-size <code>StateSpace</code>, such as <code>SO2</code> or <code>SO3</code>, you may directly instantiate and modify the <code>State</code> type: </p><div class="fragment"><div class="line"> {c++}</div>
<div class="line">SO2::State fixed_state;</div>
<div class="line">fixed_state.fromAngle(M_PI);</div>
</div><!-- fragment --><p>This is not possible on <em>variable-size <code>StateSpace</code></em>, such as <code>Rn</code> and <code>CartesianProduct</code>: the <code>State</code> does not know its own size! You must create <em>and</em> modify variable-length <code>State</code>s through their <code>StateSpace</code> class: </p><div class="fragment"><div class="line"> {c++}</div>
<div class="line">Rn space(2);</div>
<div class="line">auto state = static_cast&lt;Rn::State*&gt;(space.allocateState());</div>
<div class="line">space.setValue(state, Eigen::Vector2d(1., 2.));</div>
</div><!-- fragment --><p>We provide a <code>StateHandle</code> class to automate this operation: </p><div class="fragment"><div class="line"> {c++}</div>
<div class="line">Rn::StateHandle state_handle(&amp;space, state);</div>
<div class="line">state_handle.setValue(Eigen::Vector2d(3., 4.));</div>
</div><!-- fragment --><p>In both cases, you must remember to call <code>space.deallocateState(state)</code> to avoid leaking memory. We provide a <code>ScopedState</code> class that combines the functionality of <code>StateHandle</code> with RAII memory management: </p><div class="fragment"><div class="line"> {c++}</div>
<div class="line">Rn::ScopedState scoped_state(&amp;space);</div>
<div class="line">scoped_state.setValue(Eigen::Vector2d(1., 2.));</div>
</div><!-- fragment --><p>For typical use, we <em>strongly</em> recommend using <code>ScopedState</code> to avoid manual memory management. However, the convenience of <code>StateHandle</code> and <code>ScopedState</code> comes at the cost of memory overhead. We suggest avoiding these classes, by using the operations provided by <code>StateSpace</code>, in performance-critical code. This is especially important when creating a large number of states, e.g. when implementing a sample-based motion planner.</p>
<h2><a class="anchor" id="autotoc_md2"></a>
Working with &lt;tt&gt;CartesianProduct&lt;/tt&gt;</h2>
<p><code>CartesianProduct</code> represents the Cartesian product of an arbitrary number of heterogeneous <code>StateSpace</code>s, known as <em>subspaces</em>: </p><div class="fragment"><div class="line"> {c++}</div>
<div class="line">CartesianProduct compound_space({</div>
<div class="line">  std::make_shared&lt;SO2&gt;(),</div>
<div class="line">  std::make_shared&lt;Rn&gt;(2)</div>
<div class="line">});</div>
<div class="line">CartesianProduct::ScopedState compound_handle(compound_space);</div>
<div class="line">CartesianProduct::State* compound_state = compound_handle.getState();</div>
</div><!-- fragment --><p>This class also provides member functions for retrieving a subspace by index. Accessing a subspace with incorrect type will result in a runtime error (in debug mode) or crash (in release mode): </p><div class="fragment"><div class="line"> {c++}</div>
<div class="line">compound_space.getSubspace&lt;SO2&gt;(0); // OK</div>
<div class="line">compound_space.getSubspace&lt;Rn&gt;(1); // OK</div>
<div class="line">compound_space.getSubspace&lt;StateSpace&gt;(1); // OK, inherits from StateSpace</div>
<div class="line">compound_space.getSubspace&lt;SO2&gt;(1); // ERROR, type mismatch</div>
</div><!-- fragment --><p>Since <code>CartesianProduct</code> is variable-length*, it also provides member functions for accessing substates by index. Just as above, accessing an incorrect type will result in a runtime error or crash: </p><div class="fragment"><div class="line"> {c++}</div>
<div class="line">compound_space.getSubState&lt;SO2&gt;(compound_state, 0); // OK</div>
<div class="line">compound_space.getSubState&lt;Rn&gt;(compound_state, 1); // OK</div>
<div class="line">compound_space.getSubState&lt;StateSpace&gt;(compound_state, 1); // OK</div>
<div class="line">compound_space.getSubState&lt;SO2&gt;(compound_state, 1); // ERROR, type mismatch</div>
</div><!-- fragment --><p>This is inconvienent when working with nested variable-length state spaces. For example, the following code is required to set the real vector component of <code>compound_state</code>: </p><div class="fragment"><div class="line"> {c++}</div>
<div class="line">compound_space.getSubspace&lt;Rn&gt;(1).setValue(</div>
<div class="line">  compound_space.getSubState&lt;Rn&gt;(compound_state, 1), Eigen::Vector2d(3., 4.));</div>
</div><!-- fragment --><p>It is significantly less verbose to use the <code>StateHandle</code> wrapper: </p><div class="fragment"><div class="line"> {c++}</div>
<div class="line">compound_handle.getSubStateHandle&lt;Rn&gt;(1).setValue(Eigen::Vector2d(3., 4.));</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md3"></a>
Implementing your own &lt;tt&gt;StateSpace&lt;/tt&gt;</h2>
<p>It is straightforward to implement your own <code>StateSpace</code>. The type <code>SS</code> satisfies the <code>StateSpace</code> concept iff:</p>
<ul>
<li>The type <code>SS</code> inherits from <code><a class="el" href="../../d7/d19/classaikido_1_1statespace_1_1StateSpace.html" title="Represents a Lie group and its associated Lie algebra, i.e.">aikido::statespace::StateSpace</a></code></li>
<li>The type <code>SS::State</code> has no virtual functions</li>
<li>The type <code>SS::State</code> inherits from <code><a class="el" href="../../d1/d3a/classaikido_1_1statespace_1_1StateSpace_1_1State.html">aikido::statespace::StateSpace::State</a></code></li>
<li>The type <code>SS::StateHandle</code> inherits from <code><a class="el" href="../../d3/d6c/classaikido_1_1statespace_1_1StateHandle.html" title="Wrap a State with its StateSpace to provide convenient accessor methods.">aikido::statespace::StateHandle</a>&lt;SS, SS::State&gt;</code></li>
<li>The type <code>SS::StateHandleConst</code> inherits from <code><a class="el" href="../../d3/d6c/classaikido_1_1statespace_1_1StateHandle.html" title="Wrap a State with its StateSpace to provide convenient accessor methods.">aikido::statespace::StateHandle</a>&lt;SS, const SS::State&gt;</code></li>
<li>The type <code>SS::ScopedState</code> is <code><a class="el" href="../../dd/df2/classaikido_1_1statespace_1_1ScopedState.html" title="CRTP RAII wrapper for a StateHandle.">aikido::statespace::ScopedState</a>&lt;SS:StateHandle&gt;</code></li>
<li>The type <code>SS::ScopedStateConst</code> is <code><a class="el" href="../../dd/df2/classaikido_1_1statespace_1_1ScopedState.html" title="CRTP RAII wrapper for a StateHandle.">aikido::statespace::ScopedState</a>&lt;SSStateHandleConst&gt;</code></li>
</ul>
<p>Inheriting from <code><a class="el" href="../../d7/d19/classaikido_1_1statespace_1_1StateSpace.html" title="Represents a Lie group and its associated Lie algebra, i.e.">aikido::statespace::StateSpace</a></code> requires implementing several pure-<code>virtual</code> methods:</p>
<ul>
<li><code>getStateSizeInBytes</code> returns the amount of memory required, in bytes, by <code>allocateStateInBuffer</code>. For a fixed-size state, this is typically <code>sizeof(MyState)</code>.</li>
<li><code>allocateStateInBuffer</code> constructs a <code>State</code> object in the buffer passed as an argument. For a fixed size state, this is typically implemented using the placement<code>-new</code> operator: <code>new (_buffer) MyState</code>.</li>
<li><code>freeStateInBuffer</code> frees memory associated with a <code>State</code> object previously allocated by <code>allocateStateInBuffer</code>, but <em>not the buffer itself</em>. For a fixed size state, this is typically implemented by explicitly calling the destructor: <code>_state-&gt;~MyState()</code>.</li>
<li><code>compose</code> applies the multiplication operator associated with the <code>StateSpace</code>'s Lie group to <code>_state1</code> and <code>_state2</code>, storing the result in the output parameter <code>_out</code>. For a real vector space, this operator implements vector addition. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Mar 10 2023 20:07:57 for Aikido by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
