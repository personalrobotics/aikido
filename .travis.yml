dist: trusty

sudo: required

group: travis_lts

language: generic

env:
  global:
    - TIMEOUT=30

cache:
  apt: true
  directories:
    - /usr/local/Cellar

matrix:
  include:
    - os: linux
      compiler: gcc
      env:
        - BUILD_NAME=TRUSTY_DEBUG
        - REQUIRED_ONLY=--required-only
        - BUILD_TYPE=Debug
        - CATKIN_CONFIG_OPTIONS="-DCMAKE_BUILD_TYPE=Debug -DTREAT_WARNINGS_AS_ERRORS=ON"
    - os: linux
      compiler: gcc
      env:
        - BUILD_NAME=TRUSTY_RELEASE
        - REQUIRED_ONLY=--required-only
        - BUILD_TYPE=Release
        - CATKIN_CONFIG_OPTIONS="-DCMAKE_BUILD_TYPE=Release -DTREAT_WARNINGS_AS_ERRORS=ON"
    - os: linux
      compiler: gcc
      env:
        - BUILD_NAME=TRUSTY_FULL_DEBUG
        - BUILD_TYPE=Debug
        - CATKIN_CONFIG_OPTIONS="-DCMAKE_BUILD_TYPE=Debug -DTREAT_WARNINGS_AS_ERRORS=ON"
    - os: linux
      compiler: gcc
      env:
        - BUILD_NAME=TRUSTY_FULL_RELEASE
        - BUILD_TYPE=Release
        - CATKIN_CONFIG_OPTIONS="-DCMAKE_BUILD_TYPE=Release -DTREAT_WARNINGS_AS_ERRORS=ON"
    - os: osx
      osx_image: xcode9.3
      compiler: clang
      env:
        - BUILD_NAME=XCODE93_DEBUG
        - BUILD_TYPE=Debug
    - os: osx
      osx_image: xcode9.3
      compiler: clang
      env:
        - BUILD_NAME=XCODE93_RELEASE
        - BUILD_TYPE=Release

before_install:
  - if [ "${TRAVIS_OS_NAME}" = "linux" ]; then . "${TRAVIS_BUILD_DIR}/.ci/before_install_linux.sh"; fi

install:
  - if [ "${TRAVIS_OS_NAME}" = "linux" ]; then . "${TRAVIS_BUILD_DIR}/.ci/install_linux.sh"; fi
  - if [ "${TRAVIS_OS_NAME}" = "osx"   ]; then . "${TRAVIS_BUILD_DIR}/.ci/install_macos.sh"; fi

script:
  - if [ "${TRAVIS_OS_NAME}" = "linux" ]; then . "${TRAVIS_BUILD_DIR}/.ci/script_linux.sh"; fi
  - if [ "${TRAVIS_OS_NAME}" = "osx"   ]; then . "${TRAVIS_BUILD_DIR}/.ci/script_macos.sh"; fi
  - if [ "${BUILD_NAME}" = "TRUSTY_FULL_RELEASE" ]; then . "${TRAVIS_BUILD_DIR}/.ci/build_docs.sh"; fi

after_script:
  - if [ "${TRAVIS_OS_NAME}" = "linux" ]; then ./scripts/view-all-results.sh test_results; fi

after_failure:
  - if [ "${TRAVIS_OS_NAME}" = "linux" ]; then cat ./build/aikido/Testing/Temporary/LastTest.log; fi
  - if [ "${TRAVIS_OS_NAME}" = "linux" ]; then cat ./build/aikido/Testing/Temporary/LastTestsFailed.log; fi
  - if [ "${TRAVIS_OS_NAME}" = "osx"   ]; then cat Testing/Temporary/LastTest.log; fi
  - if [ "${TRAVIS_OS_NAME}" = "osx"   ]; then cat Testing/Temporary/LastTestsFailed.log; fi

deploy:
  github-token: $GITHUB_TOKEN
  provider: pages
  skip-cleanup: true
  local-dir: gh-pages
  keep-history: false
  verbose: true
  on:
    branch: master
    condition: $BUILD_NAME == TRUSTY_FULL_RELEASE && $TRAVIS_EVENT_TYPE != cron
